## SQL培训提纲

目的：通过2个案例，了解项目开发中数据库相关的开发要点。

#### 案例一、外卖商品核销计算

**需求1：**外卖商品在工作日下单后，供应商当晚备货，可在下一工作日领取（核销）。基于金融日历文件，请编写sql，计算下单后的下一工作日。

实现流程：

1. 开发环境

   配置给定的数据库环境

   新建数据库用户及表空间

2. 根据金融日历文件结构建表

   Tips：建表注意事项

   有意义的命名

   字段名建议下划线分割单词或词组

   注释要清晰完整

   了解数据含义，明确主键

   合理的字段类型和长度设置，比如金额22位数值型，单位到分，日期注意格式

   字段默认值的运用

   指定数据表空间和索引表空间

   若数据量较大，需使用分区

3. 文件导入

   Tips：常用导入方式

   基于Oracle数据库可使用高效率的SqlLoader工具，分隔符文件导入

   使用Java读取解析文件，批量写入数据库

4. sql

   Tips：

   SELECT是对二维数据集的操作，包括限定，关联，汇总和排序等



**需求2：**外卖商品领取时间由1个工作日调整到3个工作日，请调整sql，计算下单日期的最晚领取工作日

​	Tips：

​	1.把子查询结果集作为表来处理



**需求3：**外卖商品包含多种类型，每种类型的领取时间不同，设计相应的参数表，编写sql，计算给类商品最晚领取工作日

​	Tips：

- 笛卡尔集
- 多表关联
- 扩展知识，in、exists和2表关联，A和B数据量很小，A数据量大B数据量小，A数据量小B数据量大，对应3种情况，下列3句哪句效率高

​	select * from A where id in (select id from B)

​	select * from A where exists(select 1 from B where a.id = b.id)

​	select A.* from A,B where a.id = b.id

​	not in和not exists，尽量别用not in

- 左外关联
- 分组排序



**需求4：**编写Oracle函数，输入品类ID和订单日期，判断今天是否可以领取订单

​	PLSQL介绍，Function，Procedure，Package

​	明确输入和输出

​	完整的注释

​	格式整洁有层次

​	



#### 案例二、事务的实践

测试1：A客户端更新一条记录，但未提交，B客户端查询结果是什么？



测试2：A客户端更新一条记录，但未提交，B客户端可以更新同一张表的另一条记录吗？



测试3：A客户端select * from A for update, B客户端还能更新同一张表的记录吗？



commit和rollback



悲观锁和乐观锁



