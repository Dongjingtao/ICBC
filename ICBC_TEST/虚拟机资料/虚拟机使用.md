# 虚拟机使用与学习环境搭建

一般在学习的过程中，推荐在虚拟机环境中搭建学习环境。

使用虚拟机可以比较方便的和你的宿主系统隔离，能获得这些好处：

- 一些大型软件安装较为繁琐，也可能影响你主机的性能。安装在虚拟机中，不用的时候可以彻底关闭，重装系统不影响虚拟机。
- 分享迁移比较方便，一般从一台机器打包一组文件复制到另一台机器即可启动使用。
- 如果发生一些破坏性的操作，只要做好备份，能够比较方便的恢复原状态。



## 虚拟机VM与容器Docker

虚拟机包含完整的操作系统，容器是一个剪裁的系统，通常使用大量宿主机操作系统的资源。

虚拟机通常体积较大（GB级别），容器通常较小（MB级别）。

容器一般只能跑在linux上，容器内部也只支持linux，虚拟机没有限制。

一般情况下，我们使用windows作为我们的宿主系统，以便提供一些娱乐和办公功能，然后可以搭建一个linux的虚拟机环境，提供一些稳定的测试开发功能，如果需要学习docker，一般在虚拟机中再安装docker。

目前主流的虚拟化产品包括hyper-v,xgen,kvm,vmware等等。

- hyper-v是微软的产品，通常买正版的windows server会带，目前最新版本的windows10中也提供虚拟化功能。

- xgen和kvm是Linux上的开源产品。

- vmware是老牌虚拟化厂商。



常见的桌面级别免费的产品包括vmware player 和virtual box。

virtualbox是oracle的开源产品。

vmware player不是开源产品，但可以免费使用，支持linux和windows，不支持mac。

本次培训提供一个安装好环境的vmware的虚拟机镜像，以方便大家在linux上调试程序。



## VMware Player下载与安装

推荐直接官网下载  

https://www.vmware.com/products/workstation-player.html

安装的时候选择没有SN即可。

硬件推荐8GB内存以上，固盘256GB以上，CPU越快越好。虚拟机的硬盘文件建议保存在固盘上。

- **需要64位系统**
- **BIOS打开CPU的虚拟化选项。**
- **BIOS需要关闭SecureBoot**

宿主系统是windows的话，一般直接安装即可。

如果在linux上安装，宿主系统推荐使用ubuntu 较新版本，比如ubuntu 20.4。一般需要安装c的编译环境和一些额外的库，通常百度都能解决。

```
apt install build-essential
apt install libaio
```

通常linux下面硬件驱动是直接编译在内核中，后续安装硬件驱动比较复杂，而ubuntu会紧跟linux最新版本的内核，对新款硬件有比较好的支持。所以在自己的PC或者台式机上推荐安装ubuntu，目前最新的LTS版本是20.4。Ubuntu是Debian系统的发行版本。

过去centOS比较常用，CentOs是红帽公司的社区版本产品，红帽的产品进入中国比较早，通常互联网公司使用较多，但目前红帽公司改变了centos的定位，后续可能会使用Ubuntu比较多，包括国产linux发行版。

目前较为常见的是CentOS7，搜索资料较多。行内使用的Suse系统也是属于红帽系列的发行版，运维与centOS较为接近。所以目前培训提供的是一个Centos的虚拟机。



## VmWarePlayer常用配置

一般目前主流系统内存至少分配4GB，如果宿主机有16GB以上内存，可以考虑增加虚拟机配置。



### 网络

![image-20200804164904804](%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BD%BF%E7%94%A8.assets/image-20200804164904804.png)



网络一般选择NAT模式，需要做服务直接让外部访问的且路由器端可以分配给你多个IP的，可以使用桥接模式。网络策略严格控制的情况下，选择仅主机模式。

![image-20200804165114349](%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%BD%BF%E7%94%A8.assets/image-20200804165114349.png)



一般虚拟机运行后，还可以在虚拟机内部安装vmware Tools，以提供一些更加丰富的功能。



### 后台运行

在免费的vmplayer上通常虚拟机不可以后台运行，但是可以通过修改配置实现后台运行的目的

修改 xxxx/.vmware/preferences文件

添加或者修改以下内容

```properties
pref.vmplayer.exit.vmAction = "disconnect"
```

依然需要手工通过前端图形界面启动虚拟机，但在启动之后退出功能变为disconnect。即关闭前端UI，但是虚拟机在后台依然运行。





